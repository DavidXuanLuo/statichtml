<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>X</title>
<style>
:root{--bg:#fff;--text:#0f1419;--sub:#536471;--line:#eff3f4;--blue:#1d9bf0;--green:#00ba7c;--pink:#f91880;--icon:#536471}
*{box-sizing:border-box}
body{margin:0;background:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC",sans-serif;color:var(--text)}
.app{max-width:430px;margin:0 auto;min-height:100vh;border-left:1px solid var(--line);border-right:1px solid var(--line);background:#fff}
.top{position:sticky;top:0;background:rgba(255,255,255,.94);backdrop-filter:blur(12px);z-index:20;border-bottom:1px solid var(--line)}
.bar{height:52px;display:flex;align-items:center;justify-content:center;font-size:29px;font-weight:300}
.tabs{display:flex;height:46px}.tab{flex:1;text-align:center;font-size:15px;color:var(--sub);padding-top:14px;position:relative}.tab.on{font-weight:700;color:var(--text)}.tab.on:after{content:"";position:absolute;left:34%;right:34%;bottom:0;height:4px;border-radius:999px;background:var(--blue)}
.page{display:none}.page.on{display:block}
.card{position:relative;display:flex;gap:10px;padding:12px 14px;border-bottom:1px solid var(--line);cursor:pointer}
.av{width:40px;height:40px;border-radius:50%;object-fit:cover;flex:0 0 40px;background:#eef3f5}
.main{min-width:0;flex:1;position:relative}
.head{display:flex;align-items:center;gap:6px;white-space:nowrap;overflow:hidden}
.name{font-weight:700;font-size:15px;overflow:hidden;text-overflow:ellipsis}
.handle,.time,.dot{color:var(--sub);font-size:15px}
.zh{margin-top:4px;white-space:pre-wrap;font-size:17px;line-height:1.35;word-break:break-word}
details{margin-top:7px}
summary{color:var(--blue);font-size:13px;cursor:pointer;list-style:none;width:max-content;position:relative;z-index:3}
summary::-webkit-details-marker{display:none}
.en{margin-top:6px;color:#4b5f6a;font-size:13px;line-height:1.45;white-space:pre-wrap;word-break:break-word}
.actions{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));margin-top:10px;align-items:center;color:var(--icon);font-size:13px}
.action{display:inline-flex;align-items:center;gap:4px;width:max-content;padding:0;border:0;background:transparent;color:inherit;cursor:pointer;position:relative;z-index:3}
.action .i{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;transition:.15s ease}
.action svg{width:18px;height:18px;fill:currentColor}
.action .n{font-size:12px;line-height:1}
.action.reply:hover{color:var(--blue)}.action.reply:hover .i{background:rgba(29,155,240,.1)}
.action.rt:hover{color:var(--green)}.action.rt:hover .i{background:rgba(0,186,124,.12)}
.action.like:hover{color:var(--pink)}.action.like:hover .i{background:rgba(249,24,128,.1)}
.action.view:hover,.action.share:hover{color:#1f2d3d}.action.view:hover .i,.action.share:hover .i{background:rgba(15,20,25,.08)}
.dtop{position:sticky;top:0;height:52px;display:flex;align-items:center;gap:14px;padding:0 12px;border-bottom:1px solid var(--line);background:rgba(255,255,255,.96);backdrop-filter:blur(10px);z-index:20}
.back{border:0;background:none;font-size:22px;cursor:pointer;width:32px;height:32px;border-radius:50%}.back:hover{background:rgba(15,20,25,.08)}
.tt{font-size:20px;font-weight:700}
.sep{height:8px;background:#f7f9f9;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
.comment{display:flex;gap:10px;padding:12px 14px;border-bottom:1px solid var(--line)}
.comment .av{width:36px;height:36px;flex-basis:36px}
</style>
</head>
<body>
<div class="app">
  <div class="top"><div class="bar">ùïè</div><div class="tabs"><div class="tab on">‰∏∫‰Ω†Êé®Ëçê</div><div class="tab">Ê≠£Âú®ÂÖ≥Ê≥®</div></div></div>
  <section id="feed" class="page on"></section>
  <section id="detail" class="page"></section>
</div>
<script>
let posts=[];
const feed=document.getElementById('feed'),detail=document.getElementById('detail');
const esc=s=>String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
const d=s=>new Date(s).toLocaleDateString('zh-CN',{month:'numeric',day:'numeric'});

const icons={
reply:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M1.75 10c0-4.42 3.58-8 8-8h4.5c4.42 0 8 3.58 8 8v4c0 4.42-3.58 8-8 8H9.75c-4.42 0-8-3.58-8-8v-4zm8-6a6 6 0 0 0-6 6v4a6 6 0 0 0 6 6h4.5a6 6 0 0 0 6-6v-4a6 6 0 0 0-6-6h-4.5z"></path></svg>',
rt:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4.5 3.75a.75.75 0 0 1 .75.75V15h12.19l-1.97-1.97a.75.75 0 1 1 1.06-1.06l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 1 1-1.06-1.06l1.97-1.97H4.5a.75.75 0 0 1-.75-.75V4.5a.75.75 0 0 1 .75-.75zm15-1.5a.75.75 0 0 1 .75.75V13.5a.75.75 0 0 1-1.5 0V3h-12.2l1.98 1.97a.75.75 0 1 1-1.06 1.06L4.22 2.78a.75.75 0 0 1 0-1.06L7.47-1.53a.75.75 0 1 1 1.06 1.06L6.55 1.5H19.5z" transform="translate(0 2)"></path></svg>',
like:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16.697 5.5c-1.222 0-2.44.493-3.347 1.426L12 8.273l-1.35-1.347C9.743 5.993 8.525 5.5 7.303 5.5 4.59 5.5 2.5 7.59 2.5 10.303c0 1.6.69 3.137 1.9 4.227l6.98 6.317a1 1 0 0 0 1.24 0l6.98-6.317a5.7 5.7 0 0 0 1.9-4.227c0-2.713-2.09-4.803-4.803-4.803z"></path></svg>',
view:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 5.75A2.75 2.75 0 0 1 5.75 3h12.5A2.75 2.75 0 0 1 21 5.75v12.5A2.75 2.75 0 0 1 18.25 21H5.75A2.75 2.75 0 0 1 3 18.25V5.75zm2.75-1.25c-.69 0-1.25.56-1.25 1.25v12.5c0 .69.56 1.25 1.25 1.25h12.5c.69 0 1.25-.56 1.25-1.25V5.75c0-.69-.56-1.25-1.25-1.25H5.75zM7 15.5l2.7-3.6 2 2.2 3-4.1L17 13.2V17H7v-1.5z"></path></svg>',
share:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12.59 2.59a2 2 0 0 1 2.82 0l5 5a2 2 0 0 1-2.82 2.82L14 6.83V15a1 1 0 1 1-2 0V6.83l-3.59 3.58A2 2 0 0 1 5.59 7.6l5-5zM5 13a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-4a1 1 0 1 1 2 0v4a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3v-4a1 1 0 0 1 1-1z"></path></svg>'
};

function actions(c,i){
  return `<div class="actions">
    <button class="action reply js-open" data-i="${i}" aria-label="ÂõûÂ§ç"><span class="i">${icons.reply}</span><span class="n">${esc(c.reply||'')}</span></button>
    <button class="action rt" aria-label="ËΩ¨Âèë"><span class="i">${icons.rt}</span><span class="n">${esc(c.repost||'')}</span></button>
    <button class="action like" aria-label="ÁÇπËµû"><span class="i">${icons.like}</span><span class="n">${esc(c.like||'')}</span></button>
    <button class="action view" aria-label="ÊµèËßà"><span class="i">${icons.view}</span><span class="n">${esc(c.view||'')}</span></button>
    <button class="action share" aria-label="ÂàÜ‰∫´"><span class="i">${icons.share}</span></button>
  </div>`;
}

function row(p,i){
  return `<article class="card" data-i="${i}">
    <img class="av" src="${esc(p.avatar)}" alt="${esc(p.name)}" loading="lazy"/>
    <div class="main">
      <div class="head"><span class="name">${esc(p.name)}</span><span class="handle">${esc(p.handle)}</span><span class="dot">¬∑</span><span class="time">${d(p.time)}</span></div>
      <div class="zh">${esc(p.zh)}</div>
      <details><summary>ÂéüÊñá</summary><div class="en">${esc(p.text)}</div></details>
      ${actions(p.counts||{},i)}
    </div>
  </article>`;
}

function commentRow(c){
  return `<article class="comment">
    <img class="av" src="${esc(c.avatar)}" alt="${esc(c.name)}" loading="lazy"/>
    <div class="main">
      <div class="head"><span class="name">${esc(c.name)}</span><span class="handle">${esc(c.handle)}</span><span class="dot">¬∑</span><span class="time">${d(c.time)}</span></div>
      <div class="zh">${esc(c.zh)}</div>
      <details><summary>ÂéüÊñá</summary><div class="en">${esc(c.text)}</div></details>
      ${actions(c.counts||{},-1)}
    </div>
  </article>`;
}

function showFeed(){
  detail.classList.remove('on');
  feed.classList.add('on');
  document.querySelector('.top').style.display='block';
}

function showDetail(i,push){
  const p=posts[i]; if(!p) return;
  detail.innerHTML=`<div class="dtop"><button class="back" id="back" aria-label="ËøîÂõû">‚Üê</button><div class="tt">Â∏ñÂ≠ê</div></div>${row(p,i)}<div class="sep"></div>${(p.comments||[]).map(commentRow).join('')}`;
  feed.classList.remove('on');
  detail.classList.add('on');
  document.querySelector('.top').style.display='none';
  if(push) history.pushState({i},'',`#post-${i}`);
  document.getElementById('back').onclick=()=>history.back();
  window.scrollTo(0,0);
}

feed.addEventListener('click',e=>{
  if(e.target.closest('details')) return;
  const btn=e.target.closest('.js-open');
  if(btn){e.preventDefault();e.stopPropagation();showDetail(+btn.dataset.i,true);return}
  const card=e.target.closest('.card');
  if(card){showDetail(+card.dataset.i,true)}
});

detail.addEventListener('click',e=>{
  const btn=e.target.closest('.js-open');
  if(btn){e.preventDefault();const i=+btn.dataset.i;if(i>=0) showDetail(i,true)}
});

window.addEventListener('popstate',ev=>{
  if(ev.state&&typeof ev.state.i==='number') showDetail(ev.state.i,false);
  else showFeed();
});

fetch('./stocks-tweets-data.json').then(r=>r.json()).then(d=>{
  posts=(d.posts||[]).slice(0,50).map(p=>({...p,comments:(p.comments||[]).slice(0,50)}));
  feed.innerHTML=posts.map(row).join('');
  if(location.hash.startsWith('#post-')){const i=+location.hash.replace('#post-','');if(!Number.isNaN(i)) showDetail(i,false)}
});
</script>
</body>
</html>