<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>贾维斯工作看板</title>
  <style>
    :root { color-scheme: dark; }
    body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif; background:#0f1419; color:#e7ecf0; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 20px; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom: 16px; }
    h1 { font-size: 22px; margin: 0; }
    .muted { color:#8b98a5; font-size:13px; }
    .card { background:#17202a; border:1px solid #253341; border-radius:12px; padding:14px; margin-bottom:12px; }
    .grid { display:grid; grid-template-columns: repeat(4,minmax(120px,1fr)); gap:10px; }
    .k { font-size: 12px; color:#8b98a5; }
    .v { font-size: 24px; font-weight: 700; margin-top:4px; }
    ul { margin:8px 0 0; padding-left: 18px; }
    li { margin: 6px 0; line-height:1.45; }
    .pill { display:inline-block; padding:3px 8px; border-radius:999px; font-size:12px; border:1px solid #2f4555; color:#9fd3ff; }
    .ok { color:#69d79f; }
    .warn { color:#f4c66a; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <h1>贾维斯工作看板（实时）</h1>
    <div class="muted" id="clock">加载中...</div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
      <div>
        <div class="k">当前状态</div>
        <div id="statusText" style="font-size:18px;font-weight:600;">--</div>
      </div>
      <span class="pill" id="modeTag">--</span>
    </div>
    <div class="muted" id="statusNote" style="margin-top:8px;">--</div>
  </div>

  <div class="card grid">
    <div><div class="k">今日浏览轮次</div><div class="v" id="rounds">0</div></div>
    <div><div class="k">今日浏览总量</div><div class="v" id="scanned">0</div></div>
    <div><div class="k">今日新收录</div><div class="v" id="collected">0</div></div>
    <div><div class="k">距离下次发布</div><div class="v" id="toPublish">0</div></div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <strong>最近动作</strong><span class="muted">自动每15秒刷新</span>
    </div>
    <ul id="recent"></ul>
  </div>

  <div class="card">
    <strong>策略与规则（固定）</strong>
    <ul>
      <li>X为当前唯一采集源（小红书待账号可用后恢复双源）。</li>
      <li>仅收录高质量内容：数据、关键企业问题、技术到市场观点链条、可引发讨论。</li>
      <li>每新增10条，立即发布一期H5并回传“新增条数 + 链接”。</li>
      <li>消息内不贴正文，完整内容仅在H5查看。</li>
    </ul>
  </div>

  <div class="muted">数据文件：<code>ops-status.json</code> ｜ 最后更新：<span id="lastUpdated">--</span></div>
</div>

<script>
  const f = n => Number(n || 0).toLocaleString('zh-CN');

  async function load() {
    try {
      const res = await fetch(`./ops-status.json?t=${Date.now()}`);
      const d = await res.json();

      document.getElementById('statusText').textContent = d.status?.text || '空闲';
      document.getElementById('modeTag').textContent = d.status?.mode || 'X采集';
      document.getElementById('statusNote').textContent = d.status?.note || '';

      document.getElementById('rounds').textContent = f(d.metrics?.todayRounds);
      document.getElementById('scanned').textContent = f(d.metrics?.todayScanned);
      document.getElementById('collected').textContent = f(d.metrics?.todayCollected);
      document.getElementById('toPublish').textContent = f(d.metrics?.toNextPublish);

      const recent = document.getElementById('recent');
      recent.innerHTML = '';
      (d.recentActions || []).slice(0, 12).forEach(a => {
        const li = document.createElement('li');
        const cls = a.level === 'warn' ? 'warn' : (a.level === 'ok' ? 'ok' : '');
        li.innerHTML = `<span class="muted">[${a.time || '--:--'}]</span> <span class="${cls}">${a.text || ''}</span>`;
        recent.appendChild(li);
      });

      document.getElementById('lastUpdated').textContent = d.lastUpdated || '--';
      document.getElementById('clock').textContent = `本地时间：${new Date().toLocaleString('zh-CN')}`;
    } catch (e) {
      document.getElementById('clock').textContent = '看板数据加载失败';
    }
  }

  load();
  setInterval(load, 15000);
  setInterval(() => {
    document.getElementById('clock').textContent = `本地时间：${new Date().toLocaleString('zh-CN')}`;
  }, 1000);
</script>
</body>
</html>