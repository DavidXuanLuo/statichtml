<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>富途/老虎港股交易占比走势（代理占比）</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{margin:0;background:#f6f8fb;color:#111;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'PingFang SC',Arial,sans-serif}
    .wrap{max-width:860px;margin:0 auto;padding:14px}
    .card{background:#fff;border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    h1{font-size:20px;margin:0 0 6px}
    .muted{color:#666;font-size:13px;line-height:1.45}
    .warn{display:inline-block;background:#fff3cd;border:1px solid #ffe69a;color:#7a5c00;border-radius:999px;padding:3px 10px;font-size:12px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 6px;border-bottom:1px solid #eee;text-align:left;vertical-align:top}
    th{font-weight:600;background:#fafafa}
    code{background:#f3f4f6;padding:1px 4px;border-radius:4px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>富途/老虎港股交易占比走势（可验证代理口径）</h1>
      <div class="warn">已拿到可用数值：2025Q1-Q3 富途港股成交额 + HKEX同季度总成交额</div>
      <p class="muted">代理计算：<code>proxy_share = 富途季度港股成交额 / HKEX同季度总成交额</code>。<br/>说明：HKEX公开页可核验分母（月度）；富途季度港股成交额来自公司业绩新闻稿。老虎同口径公开数据仍缺。</p>
    </div>

    <div class="card">
      <canvas id="c" height="220"></canvas>
      <p class="muted">注：折线为代理占比（%），非官方品牌级月度市占率。</p>
    </div>

    <div class="card">
      <table id="t"></table>
    </div>

    <div class="card muted">
      数据文件：<code>hk-broker-share-trend.json</code>
    </div>
  </div>

<script>
fetch('./hk-broker-share-trend.json').then(r=>r.json()).then(d=>{
  const rows = d.data;
  const labels = rows.map(x=>x.period);
  const toPct = v => (v==null?null:+(v*100).toFixed(3));
  const futu = rows.map(x=>toPct(x.futu_proxy_share));
  const tiger = rows.map(x=>toPct(x.tiger_proxy_share));

  new Chart(document.getElementById('c'),{
    type:'line',
    data:{labels,datasets:[
      {label:'富途代理占比(%)',data:futu,borderColor:'#2563eb',backgroundColor:'#2563eb',spanGaps:false,tension:.25},
      {label:'老虎代理占比(%)',data:tiger,borderColor:'#dc2626',backgroundColor:'#dc2626',spanGaps:false,tension:.25}
    ]},
    options:{plugins:{legend:{display:true}},scales:{y:{title:{display:true,text:'%'},beginAtZero:true}}}
  });

  const table = document.getElementById('t');
  table.innerHTML = `<tr>
      <th>期间</th><th>HKEX总成交(十亿HKD)</th><th>富途港股成交(十亿HKD)</th><th>老虎港股成交(十亿HKD)</th><th>富途代理占比</th><th>老虎代理占比</th><th>状态</th>
    </tr>` + rows.map(x=>`<tr>
      <td>${x.period}</td>
      <td>${x.hkex_total_turnover ?? 'N/A'}</td>
      <td>${x.futu_hk_stock_trading_volume ?? 'N/A'}</td>
      <td>${x.tiger_hk_stock_trading_volume ?? 'N/A'}</td>
      <td>${x.futu_proxy_share==null?'N/A':(x.futu_proxy_share*100).toFixed(3)+'%'}</td>
      <td>${x.tiger_proxy_share==null?'N/A':(x.tiger_proxy_share*100).toFixed(3)+'%'}</td>
      <td>${x.status}</td>
    </tr>`).join('');
});
</script>
</body>
</html>
